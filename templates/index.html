<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Humongous AI Support</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6a0dad;
            --user-bubble-bg: #6a0dad;
            --bg-color-light: #ffffff;
            --text-color-light: #000000;
            --header-bg-light: #ffffff;
            --bot-bubble-bg-light: #f1f0f0;
            --border-color-light: #e0e0e0;
            --quick-question-hover-light: #e0e0e0;

            --bg-color-dark: #121212;
            --text-color-dark: #ffffff;
            --header-bg-dark: #1e1e1e;
            --bot-bubble-bg-dark: #2c2c2e;
            --border-color-dark: #333333;
            --quick-question-hover-dark: #444444;
        }
        [data-theme='light'] {
            --bg-color: var(--bg-color-light);
            --text-color: var(--text-color-light);
            --header-bg: var(--header-bg-light);
            --bot-bubble-bg: var(--bot-bubble-bg-light);
            --border-color: var(--border-color-light);
            --quick-question-hover: var(--quick-question-hover-light);
        }
        [data-theme='dark'] {
            --bg-color: var(--bg-color-dark);
            --text-color: var(--text-color-dark);
            --header-bg: var(--header-bg-dark);
            --bot-bubble-bg: var(--bot-bubble-bg-dark);
            --border-color: var(--border-color-dark);
            --quick-question-hover: var(--quick-question-hover-dark);
        }
        body { margin: 0; font-family: 'Poppins', sans-serif; background-color: #f0f2f5; transition: background-color 0.3s; }
        .chat-container { display: flex; flex-direction: column; height: 100vh; max-width: 100%; margin: auto; background-color: var(--bg-color); }
        @media (min-width: 768px) {
            body { display: flex; align-items: center; justify-content: center; height: 100vh; }
            .chat-container { height: 90vh; max-width: 800px; border-radius: 1rem; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        }
        .chat-header { display: flex; align-items: center; padding: 1rem; border-bottom: 1px solid var(--border-color); background-color: var(--header-bg); }
        .header-icon { width: 40px; height: 40px; background-color: #eef2f9; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 1.5rem; color: #333; }
        .header-text h1 { font-size: 1.1rem; font-weight: 600; color: var(--text-color); margin: 0; }
        .header-text p { font-size: 0.8rem; color: #666; margin: 0; }
        .header-actions { display: flex; align-items: center; gap: 6px; margin-left: auto; }
        .status { display: flex; align-items: center; gap: 6px; color: var(--text-color); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; }
        .status-dot.online { background-color: #28a745; }
        .status-dot.offline { background-color: #dc3545; }
        .header-btn { background: none; border: none; cursor: pointer; font-size: 1.2rem; color: #888; padding: 5px; }
        .chat-messages { flex: 1; padding: 1rem; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
        .message-wrapper { display: flex; flex-direction: column; max-width: 80%; }
        .message-bubble { padding: 10px 15px; border-radius: 18px; line-height: 1.5; word-wrap: break-word; }
        .bot { background-color: var(--bot-bubble-bg); color: var(--text-color); border-top-left-radius: 4px; }
        .user { background-color: var(--user-bubble-bg); color: #fff; border-top-right-radius: 4px; }
        .message-wrapper.user-message { align-self: flex-end; }
        .message-wrapper.bot-message { align-self: flex-start; }
        .timestamp { font-size: 0.7rem; color: #999; margin-top: 4px; padding: 0 5px; }
        .user-message .timestamp { text-align: right; }
        .quick-questions-container { padding: 0 1rem 1rem 1rem; }
        .quick-questions-title { font-size: 0.9rem; font-weight: 500; color: #666; margin-bottom: 8px; }
        .quick-questions-grid { display: flex; flex-wrap: wrap; gap: 8px; }
        .quick-question { background-color: var(--bot-bubble-bg); border: 1px solid var(--border-color); color: var(--text-color); padding: 6px 12px; border-radius: 16px; font-size: 0.85rem; cursor: pointer; transition: background-color 0.2s; }
        .quick-question:hover { background-color: var(--quick-question-hover); }
        .chat-input-area { display: flex; padding: 1rem; border-top: 1px solid var(--border-color); }
        #userInput { flex: 1; border: 1px solid #ddd; border-radius: 20px; padding: 10px 15px; font-size: 1rem; outline: none; background-color: var(--bg-color); color: var(--text-color); }
        #sendBtn { background: var(--primary-color); color: #fff; border: none; border-radius: 50%; width: 45px; height: 45px; margin-left: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        .typing-indicator span { height: 8px; width: 8px; margin: 0 1px; background-color: #999; display: inline-block; border-radius: 50%; animation: typing-anim 1.4s infinite ease-in-out both; }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; } .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing-anim { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="header-icon">ü§ñ</div>
            <div class="header-text"><h1>Humongous AI</h1><p>Ask me anything!</p></div>
            <div class="header-actions">
                <div class="status">
                    <div id="statusDot" class="status-dot offline"></div>
                    <span id="statusText">Connecting...</span>
                </div>
                <button id="themeToggleBtn" class="header-btn">‚òÄÔ∏è</button>
                <button id="clearChatBtn" class="header-btn">üóëÔ∏è</button>
            </div>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div id="quickQuestions" class="quick-questions-container"></div>
        <div class="chat-input-area">
            <input id="userInput" type="text" placeholder="Type your message..." autocomplete="off" disabled/>
            <button id="sendBtn" disabled>‚û§</button>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById("chatMessages");
        const userInput = document.getElementById("userInput");
        const sendBtn = document.getElementById("sendBtn");
        const statusDot = document.getElementById("statusDot");
        const statusText = document.getElementById("statusText");
        const quickQuestionsContainer = document.getElementById("quickQuestions");
        const themeToggleBtn = document.getElementById("themeToggleBtn");
        const clearChatBtn = document.getElementById("clearChatBtn");
        const htmlEl = document.documentElement;
        let socket;

        const QUICK_QUESTIONS = ["Business Hours", "Pricing", "Support Contact", "Return Policy", "Shipping Info", "Account Help"];

        function setTheme(theme) {
            htmlEl.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            themeToggleBtn.textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
        }

        function showQuickQuestions() {
            quickQuestionsContainer.style.display = 'block';
            quickQuestionsContainer.innerHTML = `<p class="quick-questions-title">Quick questions:</p>`;
            const grid = document.createElement('div');
            grid.className = 'quick-questions-grid';
            QUICK_QUESTIONS.forEach(q => {
                const btn = document.createElement('button');
                btn.className = 'quick-question';
                btn.textContent = q;
                btn.onclick = () => { userInput.value = q; sendMessage(); };
                grid.appendChild(btn);
            });
            quickQuestionsContainer.appendChild(grid);
        }

        function connectWebSocket() {
            console.log("Attempting to connect WebSocket...");
            statusText.textContent = "Connecting...";
            statusDot.className = 'status-dot offline';
            userInput.disabled = true; sendBtn.disabled = true;

            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/ws`;
            socket = new WebSocket(wsUrl);

            socket.onopen = () => {
                console.log("WebSocket connected.");
                statusText.textContent = "Online";
                statusDot.className = 'status-dot online';
                userInput.disabled = false; sendBtn.disabled = false;
            };

            socket.onmessage = (event) => {
                document.querySelector('.bot-thinking')?.remove();
                const data = JSON.parse(event.data);
                if (data.type === "chat") addMessage(data.message, "bot");
            };

            socket.onclose = () => {
                console.log("WebSocket closed. Reconnecting in 3s.");
                statusText.textContent = "Offline";
                statusDot.className = 'status-dot offline';
                userInput.disabled = true; sendBtn.disabled = true;
                setTimeout(connectWebSocket, 3000);
            };
        }

        document.addEventListener("DOMContentLoaded", () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);
            connectWebSocket();
            showQuickQuestions();
        });
        
        themeToggleBtn.addEventListener("click", () => {
            const newTheme = htmlEl.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            setTheme(newTheme);
        });

        sendBtn.addEventListener("click", sendMessage);
        userInput.addEventListener("keypress", (e) => { if (e.key === "Enter") sendMessage(); });
        clearChatBtn.addEventListener("click", () => {
            chatMessages.innerHTML = "";
            showQuickQuestions();
            addMessage("Chat cleared. How can I help?", "bot");
        });

        function sendMessage() {
            const text = userInput.value.trim();
            if (!text || !socket || socket.readyState !== WebSocket.OPEN) return;
            addMessage(text, "user");
            socket.send(text);
            userInput.value = "";
            quickQuestionsContainer.style.display = 'none';
            showThinkingIndicator();
        }

        function addMessage(text, sender) {
            const wrapper = document.createElement("div");
            wrapper.className = `message-wrapper ${sender}-message`;
            const bubble = document.createElement("div");
            bubble.className = `message-bubble ${sender}`;
            bubble.innerHTML = sender === 'bot' ? marked.parse(text) : text;
            const timestamp = document.createElement('div');
            timestamp.className = 'timestamp';
            timestamp.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            wrapper.appendChild(bubble);
            wrapper.appendChild(timestamp);
            chatMessages.appendChild(wrapper);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function showThinkingIndicator(){
            const wrapper = document.createElement('div');
            wrapper.className = 'message-wrapper bot-message bot-thinking';
            wrapper.innerHTML = `<div class="message-bubble bot"><div class="typing-indicator"><span></span><span></span><span></span></div></div>`;
            chatMessages.appendChild(wrapper);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    </script>
</body>
</html>


