<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Humongous AI Support</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6a0dad;
            --user-bubble-bg: #6a0dad;
            --bot-bubble-bg: #f1f0f0;
            --bg-color: #ffffff;
            --text-color: #000000;
        }
        body { margin: 0; font-family: 'Poppins', sans-serif; background-color: var(--bg-color); }
        .chat-container { display: flex; flex-direction: column; height: 100vh; max-width: 800px; margin: auto; background-color: white; }
        .chat-header { display: flex; align-items: center; padding: 1rem; border-bottom: 1px solid #e0e0e0; }
        .header-icon { width: 40px; height: 40px; background-color: #eef2f9; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 12px; font-size: 1.5rem; }
        .header-text h1 { font-size: 1.1rem; font-weight: 600; color: var(--text-color); margin: 0; }
        .header-text p { font-size: 0.8rem; color: #666; margin: 0; }
        .status { display: flex; align-items: center; gap: 6px; margin-left: auto; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; }
        .status-dot.online { background-color: #28a745; }
        .status-dot.offline { background-color: #dc3545; }
        .chat-messages { flex: 1; padding: 1rem; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; }
        .message-wrapper { display: flex; max-width: 80%; }
        .message-bubble { padding: 10px 15px; border-radius: 18px; line-height: 1.5; word-wrap: break-word; }
        .bot { background-color: var(--bot-bubble-bg); color: var(--text-color); border-top-left-radius: 4px; }
        .user { background-color: var(--user-bubble-bg); color: #fff; border-top-right-radius: 4px; }
        .message-wrapper.user-message { align-self: flex-end; }
        .message-wrapper.bot-message { align-self: flex-start; }
        .chat-input-area { display: flex; padding: 1rem; border-top: 1px solid #e0e0e0; }
        #userInput { flex: 1; border: 1px solid #ddd; border-radius: 20px; padding: 10px 15px; font-size: 1rem; outline: none; transition: border-color 0.2s; }
        #userInput:focus { border-color: var(--primary-color); }
        #sendBtn { background: var(--primary-color); color: #fff; border: none; border-radius: 50%; width: 45px; height: 45px; margin-left: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; transition: background-color 0.2s; }
        #sendBtn:hover { background: #8a2be2; }
        .typing-indicator { display: inline-block; }
        .typing-indicator span { height: 8px; width: 8px; margin: 0 1px; background-color: #999; display: inline-block; border-radius: 50%; animation: typing-anim 1.4s infinite ease-in-out both; }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; } .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing-anim { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1.0); } }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <div class="header-icon">ü§ñ</div>
            <div class="header-text"><h1>Humongous AI</h1><p>Ask me anything!</p></div>
            <div class="status">
                <div id="statusDot" class="status-dot offline"></div>
                <span id="statusText">Connecting...</span>
                <button id="clearChatBtn" title="Clear Chat" style="background:none; border:none; cursor:pointer; margin-left: 10px; font-size: 1.2rem; color: #6c757d;">üóëÔ∏è</button>
            </div>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="chat-input-area">
            <input id="userInput" type="text" placeholder="Type your message..." autocomplete="off" disabled/>
            <button id="sendBtn" disabled>‚û§</button>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById("chatMessages");
        const userInput = document.getElementById("userInput");
        const sendBtn = document.getElementById("sendBtn");
        const statusDot = document.getElementById("statusDot");
        const statusText = document.getElementById("statusText");
        const clearChatBtn = document.getElementById("clearChatBtn");
        let socket;

        function connectWebSocket() {
            console.log("Attempting to connect WebSocket...");
            statusText.textContent = "Connecting...";
            statusDot.className = 'status-dot offline';
            userInput.disabled = true; sendBtn.disabled = true;

            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/ws`;
            socket = new WebSocket(wsUrl);

            socket.onopen = () => {
                console.log("WebSocket connected successfully.");
                statusText.textContent = "Online";
                statusDot.className = 'status-dot online';
                userInput.disabled = false; sendBtn.disabled = false;
            };

            socket.onmessage = (event) => {
                document.querySelector('.bot-thinking')?.remove();
                const data = JSON.parse(event.data);
                if (data.type === "chat") addMessage(data.message, "bot");
            };

            socket.onclose = () => {
                console.log("WebSocket closed. Will attempt to reconnect in 3 seconds.");
                statusText.textContent = "Offline";
                statusDot.className = 'status-dot offline';
                userInput.disabled = true; sendBtn.disabled = true;
                setTimeout(connectWebSocket, 3000);
            };

            socket.onerror = (error) => {
                console.error("WebSocket Error:", error);
                statusText.textContent = "Error";
                statusDot.className = 'status-dot offline';
            };
        }

        document.addEventListener("DOMContentLoaded", connectWebSocket);
        
        sendBtn.addEventListener("click", sendMessage);
        userInput.addEventListener("keypress", (e) => { if (e.key === "Enter") sendMessage(); });
        clearChatBtn.addEventListener("click", () => {
            chatMessages.innerHTML = "";
            addMessage("Chat cleared. How can I help you now?", "bot");
        });

        function sendMessage() {
            const text = userInput.value.trim();
            if (!text || !socket || socket.readyState !== WebSocket.OPEN) return;
            addMessage(text, "user");
            socket.send(text);
            userInput.value = "";
            showThinkingIndicator();
        }

        function addMessage(text, sender) {
            const wrapper = document.createElement("div");
            wrapper.className = `message-wrapper ${sender}-message`;
            const bubble = document.createElement("div");
            bubble.className = `message-bubble ${sender}`;
            bubble.innerHTML = sender === 'bot' ? marked.parse(text) : text;
            wrapper.appendChild(bubble);
            chatMessages.appendChild(wrapper);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function showThinkingIndicator(){
            const wrapper = document.createElement('div');
            wrapper.className = 'message-wrapper bot-message bot-thinking';
            wrapper.innerHTML = `<div class="message-bubble bot"><div class="typing-indicator"><span></span><span></span><span></span></div></div>`;
            chatMessages.appendChild(wrapper);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
    </script>
</body>
</html>